events {}

http {
  ssl    on;
  ssl_certificate     /etc/nginx/certs/cert.crt;
  ssl_certificate_key /etc/nginx/certs/cert.key;
  
  include /etc/nginx/mime.types;
  sendfile on;
  gzip on;
  client_max_body_size 30m;

  proxy_cache_path /etc/nginx/cache keys_zone=one:500m max_size=1000m;

  server {
    listen 80;
    listen 443 ssl;

    server_name "~^elba\..*";

    location /api {
      proxy_pass http://backend:17000;
    }

    location / {
      root /app/public;
      gzip_static on;
      add_header Cache-Control public;
    }
  }

  server {
    listen 80;
    listen 443 ssl;

    server_name "~^dl\..*";

    location / {
      root /app/storage;
      gzip_static on;
      expires max;
      add_header Cache-Control public;
    }
  }
}